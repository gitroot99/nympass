#!/bin/bash

# You can set default directory for Password
# e.g. passpath='/Users/yourname/Dropbox/nympassdata/'
passpath=''

# Set Network Interface Name of your System for Encryption
# e.g. passkey=eth0..n (For Linux Users)
# e.g. passkey=en0..n (For OS X Users)
passkey=en4

timeout=5 #Second to clean Clipboard

getmac() {
	ifconfig $passkey | grep -Eo ..\(\:..\){5}
}

createpass() {
	read -p "Name Pass : " passname
	read -p "Account ID : " acctid
	read -s -p "Enter Passphase : " passphase
	echo ""
	echo "$acctid:$passphase" | openssl enc -aes-256-cbc -a -salt -pass pass:$(getmac) | openssl enc -aes-256-cbc -salt -out "$passpath$passname"
}

clearbg() {
	if [[ -x `which pbcopy` ]]; then
		sleep $timeout
		echo "" | pbcopy
	else
		sleep $timeout
		echo "" | xclip -sel clip
	fi
}

getpass() {
	if [[ -x `which pbcopy` ]]; then
		passdata=`openssl enc -aes-256-cbc -d -salt -in $1 | openssl enc -aes-256-cbc -a -d -salt -pass pass:$(getmac)`
		echo "Account ID : $(echo $passdata | awk -F ":" '{print $1}')"
		echo $passdata | awk -F ":" '{print $2}' | tr -d '\n' | pbcopy
		clearbg &
	else
		passdata=`openssl enc -aes-256-cbc -d -salt -in $1 | openssl enc -aes-256-cbc -a -d -salt -pass pass:$(getmac)`
		echo "Account ID : $(echo $passdata | awk -F ":" '{print $1}')"
		echo $passdata | awk -F ":" '{print $2}' | tr -d '\n' | xclip -sel clip
		clearbg &
	fi
}

usage() {
	echo "Usage : $0 [-h|--help] [create] [get password_file_path]"
	echo "  -h | --help : Help. Display this message and quit."
	echo "  create      : Create Password File."
	echo "  get         : Get Password from Password File."
	exit
}

if [ -z "$1" ]; then
	createpass
else
	case "$1" in
		create)
			createpass
			;;
		get)
			getpass $passpath$2
			;;
		-h|--help)
			usage
			;;
		*)
			usage
			;;
	esac
fi
